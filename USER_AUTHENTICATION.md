# 用户认证功能说明

## 概述

WebChat 聊天室现已支持完整的用户认证系统，包括用户注册、邮箱登录和密码验证功能。

## 新功能

### 1. 用户注册
- ✅ 用户名唯一性验证
- ✅ 邮箱唯一性验证
- ✅ 密码强度验证 (最少6位)
- ✅ 密码确认验证
- ✅ 自动头像分配
- ✅ 密码加密存储 (bcrypt)

### 2. 邮箱登录
- ✅ 邮箱格式验证
- ✅ 密码验证
- ✅ 用户在线状态检查
- ✅ 登录失败提示

### 3. 数据库升级
- ✅ 用户表添加 email 和 password 字段
- ✅ 密码加密存储
- ✅ 邮箱唯一索引
- ✅ 现有用户数据迁移

## 使用方法

### 注册新用户
1. 点击登录界面的"注册"按钮
2. 填写用户名、邮箱和密码
3. 确认密码
4. 点击"注册"按钮

### 用户登录
1. 在登录界面输入邮箱和密码
2. 点击"登录"按钮
3. 系统验证邮箱和密码

### 切换登录/注册
- 在登录界面点击"注册"按钮可切换到注册界面
- 在注册界面点击"已有账号？去登录"可切换到登录界面

## 数据库结构

### 用户表 (users)
```sql
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  avatarUrl TEXT,
  ip TEXT,
  deviceType TEXT,
  roomId TEXT,
  type TEXT DEFAULT 'user',
  time INTEGER,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## 默认账户

迁移后的现有用户默认账户信息：
- **邮箱**: `username@example.com`
- **密码**: `123456`

例如：
- 用户 `test` → `test@example.com` / `123456`
- 用户 `tester` → `tester@example.com` / `123456`

## 安全特性

### 密码安全
- 使用 bcrypt 算法加密密码
- 密码强度要求：最少6位
- 密码确认验证

### 数据验证
- 邮箱格式验证
- 用户名唯一性检查
- 邮箱唯一性检查
- 用户在线状态检查

### 错误处理
- 详细的错误提示信息
- 登录失败处理
- 注册失败处理

## 技术实现

### 后端
- **密码加密**: bcryptjs
- **数据库**: SQLite3
- **验证逻辑**: 邮箱+密码验证
- **在线检查**: 防止重复登录

### 前端
- **注册组件**: UserRegister.vue
- **登录组件**: UserLogin.vue (更新)
- **消息提示**: Message.js
- **表单验证**: 客户端验证

## 迁移说明

### 自动迁移
运行以下命令进行数据库迁移：
```bash
npm run migrate-v2
```

### 迁移内容
1. 备份现有数据库
2. 创建新的用户表结构
3. 迁移现有用户数据
4. 为现有用户生成默认邮箱和密码
5. 创建必要的索引

## 注意事项

1. **密码安全**: 建议用户首次登录后修改默认密码
2. **邮箱验证**: 当前版本不包含邮箱验证功能
3. **密码重置**: 当前版本不包含密码重置功能
4. **数据备份**: 迁移前会自动备份数据库

## 未来计划

- [ ] 邮箱验证功能
- [ ] 密码重置功能
- [ ] 用户资料编辑
- [ ] 头像上传功能
- [ ] 第三方登录 (Google, GitHub)
- [ ] 两步验证 (2FA) 